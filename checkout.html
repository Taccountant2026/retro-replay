<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Checkout | Retro Replay</title>
  <link rel="stylesheet" href="style.css">
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">

  <!-- Google tag (gtag.js) -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=G-PF6Q3TSMVL"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());
    gtag('config', 'G-PF6Q3TSMVL');
  </script>

  <style>
    /* Checkout mobile safety (keeps your current look, fixes overflow) */
    @media (max-width: 768px) {
      .checkout-actions { flex-direction: column !important; }
      .checkout-actions > * { width: 100% !important; }
      .cart-row { flex-direction: column !important; }
      .cart-row-img img { width: 100% !important; height: auto !important; max-width: 320px; }
      .cart-row-right { flex-direction: column !important; align-items: flex-start !important; gap: 1rem !important; }
      .qty-wrap { width: 100%; justify-content: space-between; }
      .subtotal-box { width: 100%; text-align: left; }
      .remove-btn { width: 100%; }
    }
  </style>
</head>
<body>

<header class="site-header">

  <!-- GLOBAL TOP BAR (single, not duplicated) -->
  <div class="header-top">
    <div class="container">
      <div class="header-promo">
        <span>ðŸ›’ Secure Checkout</span>
        <span>Tracked delivery â€¢ 14-day returns</span>
      </div>
      <div class="header-links">
        <a href="/about.html">About</a>
        <a href="/delivery.html">Delivery</a>
        <a href="/warranties.html">Warranty</a>
      </div>
    </div>
  </div>

  <!-- HEADER MAIN -->
  <div class="header-main">
    <div class="container header-content">
      <a href="/index.html" class="site-logo">
        <img src="assets/logo.png" alt="Retro Replay">
        <span>Retro Replay</span>
      </a>

      <!-- NEW: Mobile nav toggle -->
      <button class="nav-toggle"
              type="button"
              aria-label="Open menu"
              aria-expanded="false"
              aria-controls="primaryNav">â˜°</button>

      <form class="search-bar" action="/search.html" method="get" role="search">
        <input type="search" name="q" placeholder="Search consoles, accessories..." aria-label="Search products">
        <button class="search-btn" type="submit">Search</button>
      </form>

      <div class="header-actions">
        <a href="/contact.html" class="header-action"><span>ðŸ“ž</span><span>Support</span></a>
        <a href="/checkout.html" class="header-action" style="color: var(--primary);" aria-current="page">
          <span>ðŸ›’</span><span>Cart</span>
          <span class="cart-badge" id="cart-count-js">0</span>
        </a>
      </div>
    </div>
  </div>

  <!-- GLOBAL MAIN NAV -->
  <nav class="main-nav" id="primaryNav">
    <div class="container">
      <ul class="nav-list">
        <li><a href="/index.html">Main Home</a></li>
        <li><a href="/atari/index.html">Atari</a></li>
        <li><a href="/nintendo/index.html">Nintendo</a></li>
        <li><a href="/playstation/index.html">PlayStation</a></li>
        <li><a href="/sega/index.html">Sega</a></li>
        <li><a href="/xbox/index.html">Xbox</a></li>
        <li><a href="/guides.html">Setup Guides</a></li>
        <li><a href="/sourcing-request.html">Sourcing</a></li>
        <li><a href="/services.html">Services</a></li>
        <li><a href="/warranties.html">Warranty</a></li>
        <li><a href="/faq.html">FAQ</a></li>
        <li><a href="/contact.html">Contact</a></li>
      </ul>
    </div>
  </nav>

</header>

<section class="section">
  <div class="container" style="max-width: 900px;">
    <div class="section-header">
      <h2 class="section-title">Your Shopping Cart</h2>
    </div>

    <div id="cart-items-js" style="margin-bottom: 2rem;">
      <!-- Cart items rendered here -->
    </div>

    <div style="background: white; padding: 2rem; border-radius: 12px; margin-bottom: 2rem;">
      <div style="display: flex; justify-content: space-between; align-items: center; padding: 1.5rem; border-top: 2px solid var(--gray-lighter); gap: 1rem; flex-wrap: wrap;">
        <div style="font-size: 1.25rem; font-weight: 700; color: var(--dark);">Total:</div>
        <div style="font-size: 2rem; font-weight: 800; color: var(--primary);">Â£<span id="cart-subtotal-js">0.00</span></div>
      </div>
    </div>

    <div class="checkout-actions" style="display: flex; gap: 1rem; flex-wrap: wrap;">
      <a href="/index.html" class="btn btn-outline" style="flex: 1; text-align: center;">Continue Shopping</a>
      <button type="button" onclick="handleCheckout()" class="btn btn-success" style="flex: 1;">Proceed to Payment</button>
    </div>

    <div style="background: #f0f4f8; padding: 1.5rem; border-radius: 12px; margin-top: 2rem;">
      <h3 style="color: var(--primary); margin-top: 0;">Checkout Information</h3>
      <ul style="list-style: none; padding: 0; color: var(--gray); margin: 0;">
        <li>âœ“ All items include 14-day warranty</li>
        <li>âœ“ Fast, tracked shipping to UK &amp; International</li>
        <li>âœ“ Secure payment processing</li>
        <li>âœ“ 14-day returns for peace of mind</li>
      </ul>
    </div>
  </div>
</section>

<footer class="site-footer">
  <div class="container">
    <div class="footer-content">

      <div class="footer-section">
        <h3>Retro Replay</h3>
        <p>Professionally tested and cleaned gaming consoles with optional refurbishment and upgrade services for PlayStation, Xbox, Nintendo, Atari &amp; Sega systems.</p>
      </div>

      <div class="footer-section">
        <h3>Shop</h3>
        <ul class="footer-links">
          <li><a href="/playstation/index.html">PlayStation</a></li>
          <li><a href="/xbox/index.html">Xbox</a></li>
          <li><a href="/nintendo/index.html">Nintendo</a></li>
          <li><a href="/atari/index.html">Atari</a></li>
          <li><a href="/sega/index.html">Sega</a></li>
        </ul>
      </div>

      <div class="footer-section">
        <h3>Support</h3>
        <ul class="footer-links">
          <li><a href="/guides.html">Setup Guides</a></li>
          <li><a href="/faq.html">FAQ</a></li>
          <li><a href="/warranties.html">Warranty Info</a></li>
          <li><a href="/delivery.html">Delivery</a></li>
          <li><a href="/contact.html">Contact Us</a></li>
        </ul>
      </div>

      <div class="footer-section">
        <h3>Company</h3>
        <ul class="footer-links">
          <li><a href="/about.html">About Us</a></li>
          <li><a href="/process.html">Our Process</a></li>
          <li><a href="/services.html">Services</a></li>
          <li><a href="/terms.html">Policies &amp; Terms</a></li>
        </ul>
      </div>

    </div>

    <div class="footer-bottom">
      <p>Â© 2025 Retro Replay. All rights reserved. Professionally tested &amp; cleaned gaming consoles.</p>
    </div>
  </div>
</footer>

<script src="cart.js"></script>
<script src="particles.js"></script>

<script>
  function getCartSafe() {
    if (window.RetroCart && typeof window.RetroCart.getCart === 'function') return window.RetroCart.getCart();
    try { return JSON.parse(localStorage.getItem('retroCart') || '[]'); } catch { return []; }
  }

  function setCartSafe(cart) {
    localStorage.setItem('retroCart', JSON.stringify(cart));
  }

  function updateSubtotal() {
    const subtotalEl = document.getElementById('cart-subtotal-js');
    if (!subtotalEl) return;
    const cart = getCartSafe();
    const subtotal = cart.reduce((sum, item) => sum + (Number(item.price) || 0) * (Number(item.qty) || 0), 0);
    subtotalEl.textContent = subtotal.toFixed(2);
  }

  function renderCheckout() {
    // Safe cart init (updates badge, etc.)
    if (window.RetroCart && typeof window.RetroCart.loadCart === 'function') {
      window.RetroCart.loadCart();
    }

    const container = document.getElementById('cart-items-js');
    if (!container) return;

    const cart = getCartSafe();

    if (cart.length === 0) {
      container.innerHTML =
        '<div style="text-align: center; padding: 2rem; background: #f9fafb; border-radius: 12px; color: var(--gray);">Your cart is empty. <a href="/index.html" style="color: var(--primary); font-weight: 600;">Continue shopping</a></div>';
      updateSubtotal();
      return;
    }

    container.innerHTML = '';

    cart.forEach(item => {
      const div = document.createElement('div');
      div.className = 'product-card cart-row';
      div.style.cssText = 'display:flex; gap:1.5rem; align-items:stretch; background:white; padding:1.5rem; border-radius:12px; box-shadow:0 2px 8px rgba(0,0,0,0.05); border:1px solid var(--gray-lighter); margin-bottom:1rem;';

      const safeId = String(item.id ?? '');
      const safeName = String(item.name ?? 'Item');
      const safeImg = String(item.image ?? 'assets/logo.png');
      const price = Number(item.price) || 0;
      const qty = Math.max(1, Number(item.qty) || 1);

      div.innerHTML = `
        <div class="cart-row-img" style="flex-shrink:0;">
          <img src="${safeImg}" alt="${safeName}" style="width:140px; height:140px; object-fit:cover; border-radius:8px; box-shadow:0 2px 6px rgba(0,0,0,0.1);">
        </div>

        <div style="flex:1; display:flex; flex-direction:column; justify-content:space-between; gap:1rem;">
          <div>
            <h3 style="margin:0 0 0.5rem 0; font-size:1.25rem; font-weight:600; color:var(--dark);">${safeName}</h3>
            <div style="display:flex; align-items:baseline; gap:1rem; margin-bottom:0.5rem; flex-wrap:wrap;">
              <span style="font-size:1rem; color:var(--gray);">Unit Price:</span>
              <span style="font-size:1rem; font-weight:600; color:var(--dark);">Â£${price.toFixed(2)}</span>
            </div>
          </div>

          <div class="cart-row-right" style="display:flex; align-items:center; justify-content:space-between; gap:1rem; flex-wrap:wrap;">
            <div style="display:flex; align-items:center; gap:1rem; flex-wrap:wrap;">
              <span style="font-size:0.9rem; color:var(--gray); font-weight:500;">Quantity:</span>

              <div class="qty-wrap" style="display:flex; align-items:center; gap:0.5rem; background:#f3f4f6; border-radius:6px; padding:0.25rem;">
                <button type="button" class="btn"
                  style="padding:0.5rem 0.75rem; background:transparent; border:none; color:var(--primary); font-weight:700; cursor:pointer; font-size:1.1rem;"
                  data-action="qty-minus" data-id="${safeId}" aria-label="Decrease quantity">âˆ’</button>

                <span style="min-width:40px; text-align:center; font-weight:600; color:var(--dark);">${qty}</span>

                <button type="button" class="btn"
                  style="padding:0.5rem 0.75rem; background:transparent; border:none; color:var(--primary); font-weight:700; cursor:pointer; font-size:1.1rem;"
                  data-action="qty-plus" data-id="${safeId}" aria-label="Increase quantity">+</button>
              </div>
            </div>

            <div style="display:flex; align-items:center; gap:1rem; flex-wrap:wrap;">
              <div class="subtotal-box" style="text-align:right;">
                <div style="font-size:0.875rem; color:var(--gray); margin-bottom:0.25rem;">Subtotal</div>
                <div style="font-size:1.5rem; font-weight:800; color:var(--primary);">Â£${(price * qty).toFixed(2)}</div>
              </div>

              <button type="button" class="btn btn-outline remove-btn"
                style="padding:0.6rem 1.2rem; font-size:0.9rem; white-space:nowrap;"
                data-action="remove" data-id="${safeId}">Remove</button>
            </div>
          </div>
        </div>
      `;

      container.appendChild(div);
    });

    // Wire up buttons
    document.querySelectorAll('[data-action="qty-minus"]').forEach(btn => {
      btn.addEventListener('click', () => updateQty(btn.dataset.id, -1));
    });
    document.querySelectorAll('[data-action="qty-plus"]').forEach(btn => {
      btn.addEventListener('click', () => updateQty(btn.dataset.id, 1));
    });
    document.querySelectorAll('[data-action="remove"]').forEach(btn => {
      btn.addEventListener('click', () => {
        if (window.RetroCart && typeof window.RetroCart.removeItem === 'function') {
          window.RetroCart.removeItem(btn.dataset.id);
        } else {
          const cart = getCartSafe().filter(i => String(i.id) !== String(btn.dataset.id));
          setCartSafe(cart);
        }
        renderCheckout();
      });
    });

    updateSubtotal();
  }

  function updateQty(id, delta) {
    // Prefer RetroCart API if available (keeps badge consistent)
    if (window.RetroCart && typeof window.RetroCart.getCart === 'function') {
      const cart = window.RetroCart.getCart();
      const item = cart.find(i => String(i.id) === String(id));
      if (item) {
        item.qty = Math.max(1, (Number(item.qty) || 1) + delta);
        localStorage.setItem('retroCart', JSON.stringify(cart));
        if (typeof window.RetroCart.loadCart === 'function') window.RetroCart.loadCart();
      }
      renderCheckout();
      return;
    }

    const cart = getCartSafe();
    const item = cart.find(i => String(i.id) === String(id));
    if (item) {
      item.qty = Math.max(1, (Number(item.qty) || 1) + delta);
      setCartSafe(cart);
    }
    renderCheckout();
  }

  function handleCheckout() {
    const cart = getCartSafe();
    if (cart.length === 0) {
      alert('Your cart is empty');
      return;
    }
    alert('Thank you for your order! In a real application, you would be redirected to payment processing.');
  }

  document.addEventListener('DOMContentLoaded', () => {
    // Mobile nav toggle
    const btn = document.querySelector('.nav-toggle');
    const nav = document.getElementById('primaryNav');
    if (btn && nav) {
      btn.addEventListener('click', () => {
        const open = nav.classList.toggle('is-open');
        btn.setAttribute('aria-expanded', open ? 'true' : 'false');
      });
    }

    renderCheckout();
  });
</script>

</body>
</html>
