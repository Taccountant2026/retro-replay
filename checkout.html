<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1.0">
<title>Retro Replay — Checkout</title>
<link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;600;700;900&display=swap" rel="stylesheet">
<link rel="shortcut icon" href="assets/logo.png" type="image/x-icon">
<style>
:root{
  --bg:#181b23;
  --panel:#22262f;
  --muted:#e3e7ed;
  --accent:#6db8ff;
  --panel-2:#2a2f3a;
}
html,body{height:100%}
body{
  font-family:'Orbitron',sans-serif;
  background:var(--bg);
  color:var(--muted);
  margin:0; padding:0;
}
.wrap{ max-width:1200px; margin:0 auto; padding:2rem; }
header{
  display:flex; justify-content:space-between; align-items:center;
  flex-wrap: wrap; margin-bottom:2rem;
}
.logo{ height:100px; width:auto; z-index:2; }
nav a{ color:var(--accent); text-decoration:none; font-weight:bold; margin-right:1rem; }
nav a:hover{ text-decoration:underline; color:#8ec5ff; }
.section-title{ font-size:2rem; margin-bottom:1rem; color:var(--accent); text-align:center; }
.cart-item{
  display:flex;
  gap:1rem;
  background:var(--panel);
  padding:1rem;
  border-radius:8px;
  margin-bottom:1rem;
  align-items:center;
}
.cart-item img{ width:100px; border-radius:4px; }
.ci-info{ flex:1; }
.ci-info div{ margin-bottom:0.3rem; }
.cart-actions{ display:flex; gap:0.5rem; margin-top:0.5rem; }
.cart-actions button{ background:var(--panel-2); color:var(--muted); border:none; padding:0.4rem 0.6rem; cursor:pointer; border-radius:6px; }
.cart-summary{ text-align:right; font-size:1.2rem; margin-top:1rem; }
#paypal-button-container{ margin-top:1rem; text-align:right; }
</style>
</head>
<body>
<div class="wrap">
<header>
  <img src="assets/logo.png" alt="Retro Replay logo" class="logo">
  <nav>
    <a href="index.html">Home</a>
    <a href="products.html">Products</a>
  </nav>
</header>

<h2 class="section-title">Your Basket</h2>

<div id="cart-items-js">
  <!-- Cart items will be rendered here -->
</div>

<div class="cart-summary">
  Subtotal: £<span id="cart-subtotal-js">0.00</span>
</div>

<div id="paypal-button-container"></div>
</div>

<script src="cart.js"></script>
<script src="https://www.paypal.com/sdk/js?client-id=YOUR_PAYPAL_CLIENT_ID&currency=GBP"></script>
<script>
// Render cart items and subtotal
function renderCheckoutCart(){
  const container = document.getElementById('cart-items-js');
  container.innerHTML = '';

  const cart = JSON.parse(localStorage.getItem('retroCart') || '[]');

  cart.forEach(item=>{
    const div = document.createElement('div');
    div.className='cart-item';
    div.innerHTML=`
      <img src="${item.image}" alt="${item.name}">
      <div class="ci-info">
        <div style="font-weight:800;color:#eaf3ff">${item.name}</div>
        <div>£${item.price.toFixed(2)} x ${item.qty} = £${(item.price*item.qty).toFixed(2)}</div>
        <div class="cart-actions">
          <button onclick="adjustQty('${item.id}',-1)">-</button>
          <button onclick="adjustQty('${item.id}',1)">+</button>
          <button onclick="RetroCart.removeItem('${item.id}')">Remove</button>
        </div>
      </div>
    `;
    container.appendChild(div);
  });

  const subtotalEl = document.getElementById('cart-subtotal-js');
  if(subtotalEl){
    let subtotal = cart.reduce((sum,item)=>sum+item.price*item.qty,0);
    subtotalEl.textContent = subtotal.toFixed(2);
  }

  renderPayPalButton();
}

// Adjust quantity
function adjustQty(id,delta){
  const cart = JSON.parse(localStorage.getItem('retroCart') || '[]');
  const item = cart.find(i=>i.id===id);
  if(item){
    item.qty += delta;
    if(item.qty<1) item.qty=1;
    localStorage.setItem('retroCart',JSON.stringify(cart));
    renderCheckoutCart();
    RetroCart.loadCart();
  }
}

// Render PayPal button
function renderPayPalButton(){
  const cart = JSON.parse(localStorage.getItem('retroCart') || '[]');
  const subtotal = cart.reduce((sum,item)=>sum+item.price*item.qty,0);
  paypal.Buttons({
    style: { layout: 'vertical', color: 'blue', shape: 'pill', label: 'pay' },
    createOrder: function(data, actions) {
      return actions.order.create({
        purchase_units: [{
          amount: {
            currency_code: "GBP",
            value: subtotal.toFixed(2)
          },
          description: "Retro Replay Order"
        }]
      });
    },
    onApprove: function(data, actions) {
      return actions.order.capture().then(function(details) {
        alert('Transaction completed by ' + details.payer.name.given_name + '!');
        localStorage.removeItem('retroCart'); // clear cart after payment
        window.location.href = 'thankyou.html';
      });
    }
  }).render('#paypal-button-container');
}

// Initial render
renderCheckoutCart();
</script>
</body>
</html>
