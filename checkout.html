<!-- =========================
  RetroReplay UK â€” checkout.html (MASTERED)
  Changes:
  - Removes inline styles + <style> block (moves to reusable CSS hooks)
  - Uses MASTER header + full nav (same as index/about)
  - Uses footer-grid (matches your unified CSS)
  - Adds cookie banner + consent JS (matches index)
  - Checkout layout uses clean class hooks: rr-checkout-*
  - Cart rendering uses CSS classes instead of style="..."
========================= -->
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />

  <title>Checkout | Retro Replay</title>
  <meta name="description" content="Secure checkout for Retro Replay. View your cart, adjust quantities, and proceed to payment with tracked delivery options." />

  <link rel="stylesheet" href="/style.css" />
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet" />

  <link rel="canonical" href="https://retroreplay.uk/checkout.html" />
  <meta name="theme-color" content="#0066ff" />
  <meta property="og:title" content="Checkout | Retro Replay" />
  <meta property="og:description" content="Secure checkout for Retro Replay. Review your cart and proceed to payment." />
  <meta property="og:type" content="website" />
  <meta property="og:image" content="/assets/og-cover.jpg" />
  <meta name="twitter:card" content="summary_large_image" />

  <script async src="https://www.googletagmanager.com/gtag/js?id=G-PF6Q3TSMVL"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());
    gtag('config', 'G-PF6Q3TSMVL', { anonymize_ip: true });
  </script>
</head>

<body>

  <!-- HEADER (MASTER) -->
  <header class="site-header">

    <div class="header-top">
      <div class="container">
        <div class="header-promo">
          <span>ðŸ›’ Secure Checkout</span>
          <span>Tracked delivery â€¢ 14-day returns</span>
        </div>
        <div class="header-links">
          <a href="/about.html">About</a>
          <a href="/delivery.html">Delivery</a>
          <a href="/warranties.html">Warranty</a>
        </div>
      </div>
    </div>

    <div class="header-main">
      <div class="container header-content">

        <a href="/" class="site-logo" aria-label="Retro Replay Home">
          <img src="/assets/logo.png" alt="Retro Replay Logo" width="48" height="48" loading="eager" decoding="async" />
          <span>Retro Replay</span>
        </a>

        <form class="search-bar" action="/search.html" method="get" role="search">
          <input type="search" name="q" placeholder="Search consoles, accessories..." aria-label="Search products" />
          <button class="search-btn" type="submit">Search</button>
        </form>

        <div class="header-actions">
          <a href="/contact.html" class="header-action"><span aria-hidden="true">ðŸ“ž</span><span>Support</span></a>

          <a href="/checkout.html" class="header-action" aria-current="page">
            <span aria-hidden="true">ðŸ›’</span><span>Cart</span>
            <span class="cart-badge" id="cart-count-js" aria-label="Cart items">0</span>
          </a>

          <button class="nav-toggle"
            type="button"
            aria-label="Toggle navigation"
            aria-expanded="false"
            aria-controls="primaryNav">â˜°</button>
        </div>

      </div>
    </div>

    <nav class="main-nav" id="primaryNav" aria-label="Primary">
      <div class="container">
        <ul class="nav-list">
          <li><a href="/">Main Home</a></li>
          <li><a href="/atari/index.html">Atari</a></li>
          <li><a href="/nintendo/index.html">Nintendo</a></li>
          <li><a href="/playstation/index.html">PlayStation</a></li>
          <li><a href="/sega/index.html">Sega</a></li>
          <li><a href="/xbox/index.html">Xbox</a></li>
          <li><a href="/guides.html">Setup Guides</a></li>
          <li><a href="/sourcing-request.html">Sourcing</a></li>
          <li><a href="/services.html">Services</a></li>
          <li><a href="/warranties.html">Warranty</a></li>
          <li><a href="/faq.html">FAQ</a></li>
          <li><a href="/contact.html">Contact</a></li>
        </ul>
      </div>
    </nav>

  </header>

  <main class="rr-checkout">

    <section class="section">
      <div class="container rr-checkout-container">
        <div class="section-header">
          <h1 class="section-title">Your Shopping Cart</h1>
          <p class="section-subtitle">Adjust quantities, review subtotal, then proceed to payment.</p>
        </div>

        <div id="cart-items-js" class="rr-cart-items" aria-live="polite">
          <!-- Cart items rendered here -->
        </div>

        <div class="rr-cart-totals">
          <div class="rr-cart-total-row">
            <div class="rr-cart-total-label">Total</div>
            <div class="rr-cart-total-value">Â£<span id="cart-subtotal-js">0.00</span></div>
          </div>
        </div>

        <div class="rr-checkout-actions">
          <a href="/" class="btn btn-secondary rr-btn-wide">Continue Shopping</a>
          <button type="button" onclick="handleCheckout()" class="btn btn-primary rr-btn-wide">Proceed to Payment</button>
        </div>

        <div class="rr-checkout-info">
          <h3>Checkout Information</h3>
          <ul class="rr-checkout-info-list">
            <li>âœ“ All items include 14-day warranty</li>
            <li>âœ“ Fast, tracked shipping to UK &amp; International</li>
            <li>âœ“ Secure payment processing</li>
            <li>âœ“ 14-day returns for peace of mind</li>
          </ul>
        </div>

      </div>
    </section>

  </main>

  <!-- FOOTER (MASTER) -->
  <footer class="site-footer">
    <div class="container">

      <div class="footer-grid">

        <div class="footer-section">
          <h3>Retro Replay</h3>
          <p>Professionally tested and cleaned gaming consoles with optional refurbishment and upgrade services for PlayStation, Xbox, Nintendo, Atari &amp; Sega systems.</p>
        </div>

        <div class="footer-section">
          <h3>Shop</h3>
          <ul class="footer-links">
            <li><a href="/playstation/index.html">PlayStation</a></li>
            <li><a href="/xbox/index.html">Xbox</a></li>
            <li><a href="/nintendo/index.html">Nintendo</a></li>
            <li><a href="/atari/index.html">Atari</a></li>
            <li><a href="/sega/index.html">Sega</a></li>
          </ul>
        </div>

        <div class="footer-section">
          <h3>Support</h3>
          <ul class="footer-links">
            <li><a href="/guides.html">Setup Guides</a></li>
            <li><a href="/faq.html">FAQ</a></li>
            <li><a href="/warranties.html">Warranty Info</a></li>
            <li><a href="/delivery.html">Delivery</a></li>
            <li><a href="/contact.html">Contact Us</a></li>
          </ul>
        </div>

        <div class="footer-section">
          <h3>Company</h3>
          <ul class="footer-links">
            <li><a href="/about.html">About Us</a></li>
            <li><a href="/how-we-refurbish.html">Our Process</a></li>
            <li><a href="/services.html">Services</a></li>
            <li><a href="/terms.html">Policies &amp; Terms</a></li>
            <li><a href="/cookie-policy.html">Cookie Policy</a></li>
          </ul>
        </div>

      </div>

      <div class="footer-bottom">
        Â© 2025 Retro Replay. All rights reserved. Professionally tested &amp; cleaned gaming consoles.
      </div>

    </div>
  </footer>

  <!-- COOKIE BANNER -->
  <div class="rr-cookie is-hidden" id="rrCookie" role="dialog" aria-live="polite" aria-label="Cookie notice">
    <div class="rr-cookie-inner">
      <p>
        We use cookies to measure traffic (analytics) and improve the site.
        <a href="/cookie-policy.html">Cookie policy</a>
      </p>
      <div class="rr-cookie-actions">
        <button class="rr-cookie-btn" id="rrCookieReject" type="button">Reject</button>
        <button class="rr-cookie-btn rr-cookie-btn-primary" id="rrCookieAccept" type="button">Accept</button>
      </div>
    </div>
  </div>

  <script src="/cart.js"></script>
  <script src="/particles.js"></script>

  <script>
    function getCartSafe() {
      if (window.RetroCart && typeof window.RetroCart.getCart === 'function') return window.RetroCart.getCart();
      try { return JSON.parse(localStorage.getItem('retroCart') || '[]'); } catch { return []; }
    }

    function setCartSafe(cart) {
      localStorage.setItem('retroCart', JSON.stringify(cart));
    }

    function updateSubtotal() {
      const subtotalEl = document.getElementById('cart-subtotal-js');
      if (!subtotalEl) return;
      const cart = getCartSafe();
      const subtotal = cart.reduce((sum, item) => sum + (Number(item.price) || 0) * (Number(item.qty) || 0), 0);
      subtotalEl.textContent = subtotal.toFixed(2);
    }

    function renderCheckout() {
      if (window.RetroCart && typeof window.RetroCart.loadCart === 'function') {
        window.RetroCart.loadCart();
      }

      const container = document.getElementById('cart-items-js');
      if (!container) return;

      const cart = getCartSafe();

      if (cart.length === 0) {
        container.innerHTML = `
          <div class="rr-empty-cart">
            <p>Your cart is empty.</p>
            <a href="/" class="rr-empty-cart-link">Continue shopping</a>
          </div>
        `;
        updateSubtotal();
        return;
      }

      container.innerHTML = '';

      cart.forEach(item => {
        const safeId = String(item.id ?? '');
        const safeName = String(item.name ?? 'Item');
        const safeImg = String(item.image ?? '/assets/logo.png');
        const price = Number(item.price) || 0;
        const qty = Math.max(1, Number(item.qty) || 1);

        const row = document.createElement('article');
        row.className = 'rr-cart-row';
        row.innerHTML = `
          <div class="rr-cart-row-img">
            <img src="${safeImg}" alt="${safeName}" loading="lazy" decoding="async">
          </div>

          <div class="rr-cart-row-main">
            <div class="rr-cart-row-top">
              <h3 class="rr-cart-row-title">${safeName}</h3>
              <div class="rr-cart-row-unit">
                <span>Unit price</span>
                <strong>Â£${price.toFixed(2)}</strong>
              </div>
            </div>

            <div class="rr-cart-row-controls">
              <div class="rr-qty">
                <span class="rr-qty-label">Quantity</span>
                <div class="rr-qty-wrap">
                  <button type="button" class="rr-qty-btn" data-action="qty-minus" data-id="${safeId}" aria-label="Decrease quantity">âˆ’</button>
                  <span class="rr-qty-value" aria-label="Quantity">${qty}</span>
                  <button type="button" class="rr-qty-btn" data-action="qty-plus" data-id="${safeId}" aria-label="Increase quantity">+</button>
                </div>
              </div>

              <div class="rr-cart-row-right">
                <div class="rr-subtotal">
                  <span class="rr-subtotal-label">Subtotal</span>
                  <span class="rr-subtotal-value">Â£${(price * qty).toFixed(2)}</span>
                </div>

                <button type="button" class="btn btn-secondary rr-remove-btn" data-action="remove" data-id="${safeId}">
                  Remove
                </button>
              </div>
            </div>

          </div>
        `;

        container.appendChild(row);
      });

      document.querySelectorAll('[data-action="qty-minus"]').forEach(btn => {
        btn.addEventListener('click', () => updateQty(btn.dataset.id, -1));
      });
      document.querySelectorAll('[data-action="qty-plus"]').forEach(btn => {
        btn.addEventListener('click', () => updateQty(btn.dataset.id, 1));
      });
      document.querySelectorAll('[data-action="remove"]').forEach(btn => {
        btn.addEventListener('click', () => removeItem(btn.dataset.id));
      });

      updateSubtotal();
    }

    function removeItem(id) {
      if (window.RetroCart && typeof window.RetroCart.removeItem === 'function') {
        window.RetroCart.removeItem(id);
        if (typeof window.RetroCart.loadCart === 'function') window.RetroCart.loadCart();
        renderCheckout();
        return;
      }
      const cart = getCartSafe().filter(i => String(i.id) !== String(id));
      setCartSafe(cart);
      renderCheckout();
    }

    function updateQty(id, delta) {
      if (window.RetroCart && typeof window.RetroCart.getCart === 'function') {
        const cart = window.RetroCart.getCart();
        const item = cart.find(i => String(i.id) === String(id));
        if (item) {
          item.qty = Math.max(1, (Number(item.qty) || 1) + delta);
          localStorage.setItem('retroCart', JSON.stringify(cart));
          if (typeof window.RetroCart.loadCart === 'function') window.RetroCart.loadCart();
        }
        renderCheckout();
        return;
      }

      const cart = getCartSafe();
      const item = cart.find(i => String(i.id) === String(id));
      if (item) {
        item.qty = Math.max(1, (Number(item.qty) || 1) + delta);
        setCartSafe(cart);
      }
      renderCheckout();
    }

    function handleCheckout() {
      const cart = getCartSafe();
      if (cart.length === 0) { alert('Your cart is empty'); return; }
      alert('Thank you for your order! In a real application, you would be redirected to payment processing.');
    }

    document.addEventListener('DOMContentLoaded', () => {
      if (window.RetroCart && typeof window.RetroCart.loadCart === 'function') {
        window.RetroCart.loadCart();
      }

      const btn = document.querySelector('.nav-toggle');
      const nav = document.getElementById('primaryNav');
      if (btn && nav) {
        btn.addEventListener('click', () => {
          nav.classList.toggle('is-open');
          const open = nav.classList.contains('is-open');
          btn.setAttribute('aria-expanded', open ? 'true' : 'false');
        });

        nav.querySelectorAll('a').forEach(a => {
          a.addEventListener('click', () => {
            nav.classList.remove('is-open');
            btn.setAttribute('aria-expanded', 'false');
          });
        });
      }

      // Cookie banner
      const COOKIE_KEY = 'rr_cookie_consent';
      const banner = document.getElementById('rrCookie');
      const acceptBtn = document.getElementById('rrCookieAccept');
      const rejectBtn = document.getElementById('rrCookieReject');

      function hideBanner(){ if (banner) banner.classList.add('is-hidden'); }
      function showBanner(){ if (banner) banner.classList.remove('is-hidden'); }

      const stored = localStorage.getItem(COOKIE_KEY);
      if (!stored) showBanner();

      if (acceptBtn) acceptBtn.addEventListener('click', () => { localStorage.setItem(COOKIE_KEY,'accepted'); hideBanner(); });
      if (rejectBtn) rejectBtn.addEventListener('click', () => { localStorage.setItem(COOKIE_KEY,'rejected'); hideBanner(); });

      renderCheckout();
    });
  </script>

</body>
</html>
