<!-- FIX: Mobile menu overlay so it doesn’t “block” page + auto-close + scroll lock
     Add this to your PAGE-ONLY <style> (or global style.css if you want site-wide) -->

<style>
/* ===== Mobile Nav: overlay drawer (non-blocking, scroll-safe) ===== */
@media (max-width: 900px){
  /* Ensure header/nav sits above content but doesn't permanently cover it */
  .site-header{ position: sticky; top: 0; z-index: 1200; }

  /* Turn main nav into a slide-down drawer */
  .main-nav{
    display: block;                 /* keep nav in DOM */
    position: fixed;
    left: 0; right: 0;
    top: var(--rr-header-offset, 64px);  /* JS sets this to actual header height */
    max-height: calc(100vh - var(--rr-header-offset, 64px));
    overflow: auto;
    background: #ffffff;
    border-top: 1px solid rgba(226,232,240,.95);
    box-shadow: 0 18px 40px rgba(15,23,42,.18);
    transform: translateY(-12px);
    opacity: 0;
    pointer-events: none;
    transition: opacity .18s ease, transform .18s ease;
  }

  /* Open state (your JS already toggles .is-open on #primaryNav) */
  .main-nav.is-open{
    transform: translateY(0);
    opacity: 1;
    pointer-events: auto;
  }

  /* Make the list vertical and tappable */
  .main-nav .nav-list{
    display: grid;
    grid-template-columns: 1fr;
    gap: .25rem;
    padding: .75rem;
    margin: 0;
  }
  .main-nav .nav-list a{
    display: flex;
    padding: .85rem .9rem;
    border-radius: .75rem;
    border: 1px solid rgba(226,232,240,.9);
    background: #fff;
  }

  /* Backdrop so user can tap outside to close */
  .rr-nav-backdrop{
    position: fixed;
    inset: 0;
    background: rgba(15,23,42,.45);
    opacity: 0;
    pointer-events: none;
    transition: opacity .18s ease;
    z-index: 1100; /* below header (1200), above page */
  }
  .rr-nav-backdrop.is-open{
    opacity: 1;
    pointer-events: auto;
  }

  /* Prevent body scroll when menu open */
  body.rr-nav-lock{ overflow: hidden; }
}

/* Optional: stop any layout jump if your header is taller */
.page-offset{
  padding-top: 0; /* keep default unless you want extra spacing */
}
</style>

<!-- Add this backdrop DIV once, just before closing </body> -->
<div class="rr-nav-backdrop" id="rrNavBackdrop" aria-hidden="true"></div>

<script>
/* ===== Mobile nav behaviour (drop-in, safe) ===== */
document.addEventListener("DOMContentLoaded", () => {
  const navBtn = document.querySelector(".nav-toggle");
  const nav = document.getElementById("primaryNav");
  const backdrop = document.getElementById("rrNavBackdrop");
  const header = document.querySelector(".site-header");

  function setHeaderOffset(){
    if (!header) return;
    const h = header.getBoundingClientRect().height;
    document.documentElement.style.setProperty("--rr-header-offset", `${Math.round(h)}px`);
  }

  function openNav(){
    if (!navBtn || !nav) return;
    nav.classList.add("is-open");
    backdrop && backdrop.classList.add("is-open");
    document.body.classList.add("rr-nav-lock");
    navBtn.setAttribute("aria-expanded", "true");
  }

  function closeNav(){
    if (!navBtn || !nav) return;
    nav.classList.remove("is-open");
    backdrop && backdrop.classList.remove("is-open");
    document.body.classList.remove("rr-nav-lock");
    navBtn.setAttribute("aria-expanded", "false");
  }

  function toggleNav(){
    if (!nav) return;
    nav.classList.contains("is-open") ? closeNav() : openNav();
  }

  // Ensure offset matches actual header height (fixes “blocking page”)
  setHeaderOffset();
  window.addEventListener("resize", setHeaderOffset);

  // Toggle button
  if (navBtn && nav){
    navBtn.addEventListener("click", (e) => {
      e.preventDefault();
      toggleNav();
    });

    // Close after tap on any nav link
    nav.querySelectorAll("a").forEach(a => {
      a.addEventListener("click", () => closeNav());
    });
  }

  // Tap outside closes
  if (backdrop){
    backdrop.addEventListener("click", () => closeNav());
  }

  // ESC closes
  document.addEventListener("keydown", (e) => {
    if (e.key === "Escape") closeNav();
  });
});
</script>
